var mywrapper = document.querySelector('.words-wrapper')
var view = document.querySelector('.view');
var showmenu = document.querySelector('.menu-button')
var endturn = document.querySelector('.fin_de_tour');
var redteamwordsremaning = document.querySelector('[name="redwordsremaning"]').value;
var blueteamwordsremaning = document.querySelector('[name="bluewordsremaning"]').value;
var blackword = false;


function inializeTeam() {
    if ((Random(0, 2)) == 0) {
        team = "blue";
        blueteam = "red";
    } else {
        team = "red";
        blueteam = "blue";
    }
}

function Random(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}

function gamefinished() {
    if (blueteamwordsremaning <= 0 || redteamwordsremaning <= 0 || blackword == true) {
        return true;
    } else {
        return false;
    }
}


/****************************************
 *********CLICK SUR UN MOT****************
 *****************************************/
var mywordclickedplace = "dd";
mywrapper.addEventListener("click", function (e) {
    wordclickedplace = e.target.getAttribute("data-grid_place");
    mywordclickedplace = e.target.getAttribute("data-grid_place");
    console.log(mywordclickedplace);
    $.get('updatePDO.php', {
        mywordclickedplace: wordclickedplace
    }).done(function (data) {
        let wordclickedteam = data.team;
        console.log(wordclickedteam);
        if (gamefinished()) {
            document.querySelector('.wrapper').classList.add('active');
        }
    });


    //console.log(e.target);


});
view.addEventListener("click", function () {
    /** QUAND TOUR JOUEUR1 - DONNEE ACCES AUX MOTS EN AJOUTANT DATA-ATTRIBUTE**/
    let arrayofwords = document.querySelectorAll('.a-word');
    //console.log(arrayofwords);
    for (let i = 0; i < arrayofwords.length; i++) {
        arrayofwords[i].classList.toggle('temp');
    }
});

showmenu.addEventListener("click", function () {
    var menu = document.querySelector('.menu');
    menu.classList.toggle('active');
});



endturn.addEventListener("click", function () {

    console.log(document.querySelector('.indice_mot'));
    if (document.querySelector('.indice_mot') !== null) {
        var indice = document.querySelector('.indice_mot').value + " en " + document.querySelector('.indice_nombre').value;
    }
    console.log(indice);
    $.get('changeturnPDO.php', {
        myindice: indice
    }).done(function (data) {

    });
});

var evtSource = new EventSource("editPDO.php");
evtSource.addEventListener("ping", function (e) {
    var data = JSON.parse(e.data);
    console.log(data);
    var thewordclicked = document.querySelector('[data-grid_place="' + data.place + '"]');
    console.log(thewordclicked);
    let wordclickedteam = data.team;
    //console.log(wordclickedteam);
    thewordclicked.setAttribute("data-team", wordclickedteam);
    if (wordclickedteam == "team") {
        //console.log("BIEN JOUÉ !!");
        //redteamwordsremaning--;
    } else if (wordclickedteam == "blueteam") {
        //console.log("AIE !!");
        //blueteamwordsremaning--;
    } else if (wordclickedteam == "blackword") {
        //console.log('MOT BLACK')
        //blackword = true;
    }
    thewordclicked.classList.add('found');
    if (document.querySelector('.indice-donne') !== null) {
    var indice_donne = document.querySelector('.indice-donne');
    indice_donne.textContent = data.hint;
    }
    endturn.setAttribute("data-turn", data.turn);
    if (document.querySelector('.joueur_role').value == "playerOne") {
        // On modifie interface joueur 1 
        if (endturn.getAttribute("data-turn") == 1) {
            //C'est à son tour donc il a accès à son interface
            console.log("C'est à mon tour, rend moi mon interface !");
        } else {
            //Ce n'est pas à son tour donc il n'a plus accès à son interface
            console.log("Ah batard, tu prends mon interface !");
            var menu = document.querySelector('.playeronemenu');
            menu.classList.add("disable");
            
            
        }
    }
    if (document.querySelector('.joueur_role').value == "playerTwo") {
        // C'est au tour du joueur 2
        if (endturn.getAttribute("data-turn") == 2) {
            //C'est à son tour donc il a accès à son interface
            console.log("C'est à mon tour, rend moi mon interface !");
            
        } else {
            console.log("Ah batard, tu prends mon interface !");
            
            // Ce n'est pas à son tour donc il n'a plus accès à son interface
        }
    }
}, false);
